<!DOCTYPE html>
<html>
    <head>
        <title>CCC Samples - Waterfall chart</title>

        <meta name="svg.render.forceflash" content="true">

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="../src/cdf/jquery.js"></script>
        
        <script type="text/javascript" src="../src/data/q01-01.js"></script>
        <script type="text/javascript" src="../src/lib/protovis-d3.3.js"></script>
        <script type="text/javascript" src="../src/lib/protovis-msie.js"></script>
        <script type="text/javascript" src="../src/lib/jquery.tipsy.js"></script>
        <script type="text/javascript" src="../src/lib/tipsy.js"></script>
        <link type="text/css" href="../src/lib/tipsy.css" rel="stylesheet"/>
        <script type="text/javascript" src="../src/def/def.js"></script>


        <!-- @SCRIPTSBEG@ -->
        <script type="text/javascript" src="../src/pvc/pvc.js"></script>
        <script type="text/javascript" src="../src/pvc/pvc.text.js"></script>
        <script type="text/javascript" src="../src/pvc/pvc.color.js"></script>
        <script type="text/javascript" src="../src/pvc/pvc.trends.js"></script>
        <script type="text/javascript" src="../src/pvc/pvc.options.js"></script>
        <script type="text/javascript" src="../src/pvc/data/_data.js"></script>
        <script type="text/javascript" src="../src/pvc/data/meta/DimensionType.js"></script>
        <script type="text/javascript" src="../src/pvc/data/meta/ComplexType.js"></script>
        <script type="text/javascript" src="../src/pvc/data/meta/ComplexTypeProject.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/TranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/MatrixTranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/CrosstabTranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/RelationalTranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Atom.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Complex.js"></script>
        <script type="text/javascript" src="../src/pvc/data/ComplexView.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Datum.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Dimension.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Data.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Data.selected.js"></script>
        <script type="text/javascript" src="../src/pvc/data/GroupingSpec.js"></script>
        <script type="text/javascript" src="../src/pvc/data/DataOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/GroupingOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/LinearInterpolationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/LinearInterpolationOperSeriesState.js"></script>
        <script type="text/javascript" src="../src/pvc/data/ZeroInterpolationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/data/ZeroInterpolationOperSeriesState.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Data.operations.js"></script>
        <script type="text/javascript" src="../src/pvc/data/Data.compat.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Role.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Scene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Var.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Sign.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Panel.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Label.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Dot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Line.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Area.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Bar.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/PieSlice.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/sign/Rule.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Context.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/OptionsBase.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Axis.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/CartesianAxis.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/CartesianAxisRootScene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/CartesianAxisTickScene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/ColorAxis.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/SizeAxis.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/Legend.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletRootScene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletGroupScene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletItemScene.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletItemSceneSelection.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletItemSceneVisibility.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletItemRenderer.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/BulletItemDefaultRenderer.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/Plot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/CartesianPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/CategoricalPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/BarPlotAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/BarPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/NormalizedBarPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/WaterfallPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/PointPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/MetricXYPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/MetricPointPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/PiePlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/HeatGridPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/BoxPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/plot/BulletPlot.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.visualRoles.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.data.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.plots.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.axes.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.panels.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.selection.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBaseChart.extension.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBasePanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcPlotPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcMultiChartPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcTitlePanelAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcTitlePanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcLegendPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcCartesianAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcGridDockingPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcCartesianGridDockingPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcCartesianAbstractPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcCategoricalAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcCategoricalAbstractPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcAxisPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcAxisTitlePanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcPiePanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcPieChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBarAbstractPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBarAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBarPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBarChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcNormalizedBarPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcNormalizedBarChart.js"></script>
        <script type="text/javascript" src="../src/pvc/visual/legend/WaterfallBulletGroupScene.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcWaterfallPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcWaterfallChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcPointPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcPoint.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcHeatGridPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcHeatGridChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcMetricXYAbstract.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/MetricPointChartTranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcMetricPointPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcMetricPoint.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBulletChart.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcParallelCoordinates.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcDataTree.js"></script>
        <script type="text/javascript" src="../src/pvc/data/translation/BoxplotChartTranslationOper.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBoxplotPanel.js"></script>
        <script type="text/javascript" src="../src/pvc/pvcBoxplotChart.js"></script>
        <!-- @SCRIPTSEND@ -->

        
        
        
        <script type="text/javascript" src="pvcDocUtils.js"></script>

    </head>
    <body>

<h1>Waterfall Chart</h1>
The waterfall charts are an alternative to pie charts for displaying distributions.
However when it's time to compare the size of categories and sub-categories, 
waterfall are the most convenient representation:<br>
While in a pie-chart you would have to compare wedges at different angles, 
in a waterfall chart you just compare the size of bars as all bars are parallel to one another.
<br/>


<h2>Chart Options</h2>
<h4>Dimensions</h4>
<ul>
  <li>width</li>
  <li>height</li>
  <li>margins -
      css-like margins shorthand syntax (without units) or object with properties 'all', 'top', 'bottom', 'left' and/or 'right'.
      Margins consume the chart's width and height (inside margins).
  </li>
</ul>
<h4>Title properties</h4>
<ul>
  <li>title</li>
  <li>titlePosition</li>
  <li>titleSize</li>
</ul>
<h4>Lifecycle</h4>
<ul>
  <li>renderCallback - executed immediatly before render is called</li>
</ul>
<h4>Legend properties</h4>
<ul>
  <li>legend (true|false)</li>
  <li>legendPosition (right, top, bottom, left)</li>
  <li>legendAlign (right, left, center, top, middle, bottom)</li>
  <li>legendSize</li>
  <li>legendDrawLine (true|false)</li>
  <li>legendDrawMarker (true|false)</li>
  <li>showTooltips (true|false)</li>
</ul>

<h4>Waterfall properties</h4>
<ul>
  <li>orientation - horizontal or vertical. Default: vertical</li>
  <li>valuesVisible - Show or hide bar value. Default: false</li>
  <li>direction - Should the water fall? 'down', or not: 'up'. Default: 'down'</li>
  <li>allCategoryLabel - The label of the root group. Default: 'All'</li>
  <li>waterLineLabel - The legend label of the accumulated line. Default: 'Accumulated'</li>
  <li>waterValuesVisible - Show or hide waterfall line values. Default: valuesVisible</li>
  <li>areasVisible - Show or hide the areas that enclose waterfall groups. Default: true</li>
  <li>panelSizeRatio - Ratio of the band occupied by the pane.
Default: 0.5 (50%)</li>
  <li>barSizeMax - Maximum size of a bar in pixels. Default: 2000</li>
</ul>

<h4>Axis properties</h4>
<ul>
  <li>show{X,Y}Scale (true | false) - whether to show an axis. Default: true</li>
  <li>plot2 (true | false) - whether to show the second axis. Default: false</li>
  <li>xAxisPosition (bottom | top) - the position of the X axis. Default: bottom</li>
  <li>yAxisPosition (left | right) - the position of the Y axis. Default: left</li>
  <li>{x,y}AxisSize - the size of <i>free dimension</i> of an axis (X: height, Y: width). Default: 30</li>
  <li>{x,y}AxisFullGrid (true | false) - show lines on all (major) ticks, except the first and the last. Default: false</li>
  <li>{x,y}AxisEndLine (true | false) - show a line on the last (major) tick. Default: false</li>
  <li>{x,y}AxisTitle - The axis title text. Default: null</li>
  <li>{x,y}AxisTitleFont - The axis title font. Default: '10px sans-serif'</li>
  <li>{x,y}AxisTitleSize - The size of the axis title.
      The size is the width when the axis is vertical and the height when it is horizontal.
      The title consumes space from the specified {x|y|second}AxisSize.
      Default: The required by the font height plus a proportional margin.</li>
  <li>{x,y}AxisDomainRoundMode (none | nice | tick) - rounding mode of the domain bounds of a linear scale axis. Default: none</li>
  <li>{x,y}AxisDesiredTickCount - desired number of (major) ticks of a linear scale axis. Default: 5</li>
  <li>{x,y}AxisMinorTicks (true|false) - show minor ticks on a linear scale axis. Default: true</li>
</ul>

<h2>Extension Points</h2>
The following&nbsp;list&nbsp;serves as the basis
for Waterfall extension points:
<ul>
  <li>base_</li>
  <li>title_</li>
  <li>titleLabel_</li>
  <li>legendArea_</li>
  <li>legendPanel_</li>
  <li>legendRule_</li>
  <li>legendDot_</li>
  <li>legendLabel_</li>
  <li>{x,y}Axis_</li>
  <li>{x,y}AxisRule_</li>
  <li>{x,y}AxisGrid_</li>
  <li>{x,y}AxisScale_</li>
  <li>{x,y}AxisTicks_</li>
  <li>{x,y}AxisMinorTicks_</li>
  <li>{x,y}AxisLabel_</li>
  <li>{x,y}AxisTitleLabel_</li>
  <li>tooltip_</li>
  <li>waterLabel_</li>
  <li>waterPanel_</li>
  <li>water_</li>
  <li>chart_</li>
  <li>waterLine_</li>
  <li>waterLineLabel_</li>
  <li>waterGroup_</li>
</ul>
Sample extension points:<br>
<ul>
  <li>base_fillStyle</li>
  <li>titleLabel_font</li>
  <li>barWaterfallLine_strokeStyle</li>
</ul>

<h2>Examples</h2>
<h3>Sample Waterfall</h3>
On the left side you see the total. 
When you move to the right you see the split of this total across the four sales regions.
In each sales region as well as in the totals column you can also observe a split into two product lines.<br>
<textarea cols="55" rows="20" id="pvcWf1Code">
var wf1 = new pvc.WaterfallChart({
    canvas: "pvcWf1",
    width:  800,
    height: 500,

    title: "Sales by territory, region, market and product",
    titlePosition: "top",
    titleSize: 40,

    legend: true,
    legendPosition: "right",

    orientation: 'vertical',

    direction: 'down',  // 'up',
    areasVisible: true,
    waterValuesVisible: true,
    waterLineLabel: "Accumulated",
    allCategoryLabel: "All",
    
    animate: false,
    clickable:  true,
    selectable: true,
    hoverable:  true,

    barSizeMax: 200,
    panelSizeRatio:0.75,

    valuesVisible: true,

    yAxisPosition: "left",
    xAxisPosition: "bottom",
    
    orthoAxisDesiredTickCount: 10,

    extensionPoints: {
        waterLine_lineWidth: 2,
        xAxisLabel_textAngle:    -Math.PI/3,
        xAxisLabel_textAlign:    "right",
        xAxisLabel_textBaseline: "top",
        titleLabel_font: "bold 16px sans-serif",
        barLabel_font: "8px sans-serif"
    },

    /* Visual Role mapping */
    visualRoles: {
        //multiChart: "territory",
        series:           "product",
        category:         "territory, region, market",
        value:            "sales"
    },

    /* Data definition */
    dimensions: {
        territory: {label: "Territory"},
        region:    {label: "Region"},
        market:    {label: "Market"},
        product:   {label: "Product"},
        sales:     {label: "Sales", valueType: Number}
    },

    /* Data mapping */
    readers: [
        {names: 'product, territory, region, market, sales'}
    ],

    crosstabMode: true,
    seriesInRows: false,
    dataOptions: {categoriesCount: 3}
});

wf1.setData(testWaterfall1);
wf1.render();
</textarea>
        <button class="tryMe" onclick='tryMe(this)'>Try me</button>
        <div id="pvcWf1"></div>

<!--  
<h3>Sample horizontal Waterfall</h3>
The example 'Sample Waterfall' with an 'horizontal' orientation.<br>
<textarea cols="55" rows="20" id="pvcWf2Code">
var wf2 = new pvc.WaterfallChart({
    canvas: "pvcWf2",
    width:  400,
    height: 300,
    title:  "Sales by region and product - Horizontal",
    titlePosition: "bottom",
    titleSize: 40,
    legend: true,
    legendPosition: "top",
    legendAlign:    "right",
    margins: {right: 40},
    animate: false,
    clickable: true,
    selectable: true,
    hoverable: true,
    orientation: 'horizontal',
    stacked: true,
    barSizeMax: 100,

    panelSizeRatio:0.75,
    barSizeRatio: 1.0,

    valuesVisible: true,
    yAxisPosition: "left",
    xAxisPosition: "bottom",
    extensionPoints: {
        titleLabel_font: "16px sans-serif",         
    }});

wf2.setData(testWaterfall_01, {
    crosstabMode: true,
    seriesInRows: false
});

wf2.render();
</textarea>
        <button class="tryMe" onclick='tryMe(this)'>Try me</button>

        <div id="pvcWf2"></div>

<h3>An Advanced Waterfall</h3>
This chart shows a more advanced example, where we first show the main regions:
 USA, Europe and Rest of World.
Then, the RoW region is in turn split into its different sub-regions.<br>
<textarea cols="55" rows="25" id="pvcWf3Code">
var wf3 = new pvc.WaterfallChart({
    canvas: "pvcWf3",
    width: 500,
    height: 400,
    title: "Sales by region and product - Detailed",
    titlePosition: "bottom",
    titleSize: 40,
    legend: true,
    legendPosition: "top",
    legendAlign: "right",
    animate: false,
    clickable: true,
    selectable: true,
    hoverable: true,
    orientation: 'vertical',
    stacked: true,
    barSizeMax: 100,

    panelSizeRatio:0.75,
    barSizeRatio: 1,
    margins: 20,
    valuesVisible: true,
    yAxisPosition: "left",
    xAxisPosition: "bottom",
    extensionPoints: {
        titleLabel_font: "16px sans-serif",
        barWaterfallLine_strokeStyle:"red"
    }});

wf3.setData(testWaterfall_02,{
    crosstabMode: true,
    seriesInRows: false
});

wf3.render();
</textarea>
        <button class="tryMe" onclick='tryMe(this)'>Try me</button>
        <div id="pvcWf3"></div>

<h3>An horizontal Advanced Waterfall</h3>
The example 'An Advanced Waterfall' with an 'horizontal' orientation.<br>
<textarea cols="55" rows="25" id="pvcWf4Code">
var wf4 = new pvc.WaterfallChart({
    canvas: "pvcWf4",

    width: 450,
    height: 400,
    title: "Sales by region and product - Detailed - Horizontal",
    titlePosition: "bottom",
    titleSize: 40,
    legend: true,
    legendPosition: "top",
    legendAlign: "right",
    animate: false,
    clickable: true,
    selectable: true,

    hoverable: true,
    orientation: 'horizontal',
    stacked: true,

    barSizeMax: 100,

    panelSizeRatio:0.75,
    barSizeRatio: 1,

    valuesVisible: true,
    yAxisPosition: "left",
    xAxisPosition: "bottom",
    axisFullGrid: true,
    extensionPoints: {
        titleLabel_font: "16px sans-serif",          
        barWaterfallLine_strokeStyle:"red"
    }});

wf4.setData(testWaterfall_02, {
    crosstabMode: true,
    seriesInRows: false
});

wf4.render();
</textarea>
        <button class="tryMe" onclick='tryMe(this)'>Try me</button>
        <div id="pvcWf4"></div>
        
-->
<h3>A Balance Analysis Waterfall</h3>
This chart shows an example of how sums can be represented by a waterfall chart.<br>
<textarea cols="55" rows="25" id="pvcWf5Code">
var wf5 = new pvc.WaterfallChart({
    canvas: "pvcWf5",
    width:  500,
    height: 400,
    title: "Balance Analysis",
    legend:  true,
    legendPosition: 'right',
    animate: false,
    clickable:  true,
    selectable: true,
    hoverable:  true,
    valuesVisible: true,
    
    direction: 'up',
    areasVisible: true,
    waterValuesVisible: true,
    allCategoryLabel: "Profit",
    //waterLineLabel: "Accumulated",
    
    /* Visual Role mapping */
    visualRoles: {
        //multiChart: "territory",
        series:           "productType",
        category:         "accountType, accountSource",
        value:            "value"
    },

    /* Data definition */
    dimensions: {
       productType:   {label: "Product Type"   },
       accountType:   {label: "Account Type"   },
       accountSource: {label: "Account Source" },
       value:         {label: "Value" }
    },

    /* Data mapping */
    readers: [
        {names: 'productType, accountType, accountSource, value'}
    ],

    crosstabMode: true,
    seriesInRows: false,
    dataOptions: {categoriesCount: 2},
    
    extensionPoints: {
        xAxisLabel_textAngle:    -Math.PI/3,
        xAxisLabel_textAlign:    "right",
        xAxisLabel_textBaseline: "top",
        titleLabel_font: "16px sans-serif",
        waterLine_lineWidth: 2
    }});

wf5.setData(testWaterfallBalance, {
    crosstabMode: true,
    seriesInRows: false
});

wf5.render();
</textarea>
        <button class="tryMe" onclick='tryMe(this)'>Try me</button>
        <div id="pvcWf5"></div>
  </body>
</html>
